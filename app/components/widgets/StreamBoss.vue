<template>
  <widget-window
    :extraTabs="[ { name: $t('Manage Battle'), value: 'goal'} ]"
    v-model="tab"
  >
    <!-- streamboss setup -->
    <div slot="goal" v-if="loaded">
      <div v-if="hasGoal">
        <div class="section__body">
          <h-form-group :title="$t('Current Boss Name')">{{ wData.goal.boss_name }}</h-form-group>
          <h-form-group :title="$t('Total Health')">{{ wData.goal.total_health }}</h-form-group>
          <h-form-group :title="$t('Current Health')">{{ wData.goal.current_health }}</h-form-group>
          <h-form-group :title="$t('Mode')">{{ wData.goal.mode }}</h-form-group>
        </div>
      </div>

      <div v-if="!hasGoal">


        <validated-form ref="form" class="section__body" v-if="requestState !== 'pending'">
          <h-form-group v-model="bossCreateOptions.total_health" :metadata="metadata.total_health"/>
          <h-form-group v-model="bossCreateOptions.mode" :metadata="metadata.mode"/>
        </validated-form>

        <div v-else class="loading-spinner">
          <img src="../../../media/images/loader.svg" />
        </div>
      </div>

    </div>

    <div slot="goal-controls">

      <button
          v-show="!hasGoal"
          @click="saveGoal()"
          class="button button--action"
      >{{ $t('Set Stream Boss Health') }}</button>

      <button
          class="button button--warn"
          v-show="hasGoal"
          @click="resetGoal()"
      >{{ $t('Reset Stream Boss') }}</button>

    </div>

    <div slot="settings" v-if="loaded">
      <validated-form @input="save()">
        <h-form-group v-model="wData.settings.fade_time" :metadata="metadata.fade_time"/>

        <h-form-group >
          <bool-input v-model="wData.settings.boss_heal" :metadata="metadata.boss_heal"/>
        </h-form-group>

        <h-form-group v-model="wData.settings.skin" :metadata="metadata.skin"/>
        <h-form-group v-model="wData.settings.kill_animation" :metadata="metadata.kill_animation"/>

        <h-form-group >
          <bool-input v-model="wData.settings.bg_transparent" :metadata="metadata.bg_transparent"/>
        </h-form-group>

        <h-form-group v-model="wData.settings.follow_multiplier" :metadata="metadata.follow_multiplier"/>
        <h-form-group v-model="wData.settings.bit_multiplier" :metadata="metadata.bit_multiplier"/>
        <h-form-group v-model="wData.settings.sub_multiplier" :metadata="metadata.sub_multiplier"/>
        <h-form-group v-model="wData.settings.donation_multiplier" :metadata="metadata.donation_multiplier"/>
        <h-form-group v-model="wData.settings.background_color" :metadata="metadata.background_color"/>
        <h-form-group v-model="wData.settings.text_color" :metadata="metadata.text_color"/>
        <h-form-group v-model="wData.settings.bar_text_color" :metadata="metadata.bar_text_color"/>
        <h-form-group v-model="wData.settings.bar_color" :metadata="metadata.bar_color"/>
        <h-form-group v-model="wData.settings.font" :metadata="metadata.font"/>
      </validated-form>

    </div>


    <div slot="test" >
      <test-buttons :testers="['Follow', 'Subscription', 'Donation', 'Bits', 'Host']"/>
    </div>


  </widget-window>

</template>

<script lang="ts" src="./StreamBoss.vue.ts"></script>

<style lang="less" scoped>
  .loading-spinner {
    position: relative;
    width: 100%;
    height: 100%;
    padding-top: 100px;

    img {
      position: absolute;
      left: 50%;
      transform: translate(-50%, 0);
    }
  }
</style>
